/**
 * Build Script for Netlify
 * -------------------------
 * This script generates env-config.js from Netlify environment variables
 * during the build process. This allows the API key to be injected
 * at build time without exposing it in the repository.
 */

const fs = require('fs');
const path = require('path');

// Get the API key from Netlify environment variables
const apiKey = process.env.OPENAI_API_KEY || '';

// Create the env-config.js content
const configContent = `/**
 * Environment Configuration (Build-time Generated)
 * ------------------------------------------------
 * This file is auto-generated during Netlify build.
 * It contains environment variables injected at build time.
 * 
 * DO NOT EDIT THIS FILE MANUALLY
 * It will be regenerated on each deployment.
 */

// Initialize ENV object if it doesn't exist
window.ENV = window.ENV || {};

// Set API key from Netlify environment variable
window.ENV.OPENAI_API_KEY = ${apiKey ? `'${apiKey}'` : 'null'};
`;

// Write the file to the assets/scripts directory
const outputPath = path.join(__dirname, '..', 'assets', 'scripts', 'env-config.js');
fs.writeFileSync(outputPath, configContent, 'utf8');

if (apiKey) {
  console.log('✓ env-config.js generated successfully');
} else {
  console.warn('⚠ Warning: OPENAI_API_KEY not set in environment variables');
  console.warn('  Voice navigation features may not work until the key is configured in Netlify.');
}

